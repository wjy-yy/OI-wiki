



<!DOCTYPE html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="OI Wiki 是一个信息学奥林匹克竞赛知识整合站点，提供有趣又实用的 OI 知识以及其他有帮助的内容，帮助广大 OI 爱好者更快更深入地学习 OI 竞赛">
      
      
        <link rel="canonical" href="https://oi-wiki.org/ds/splay/">
      
      
        <meta name="author" content="OI Wiki Team">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../..">
      <meta name="generator" content="mkdocs-1.0.3, mkdocs-material-3.0.3">
    
    
      
        <title>Splay - OI Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://gstatic.loli.net" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.loli.net/css?family=Fira+Sans:300,400,400i,700|Fira+Mono">
        <style>body,input{font-family:"Fira Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Fira Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../../_static/css/extra.css?v=2">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../#_1" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://oi-wiki.org" title="OI Wiki" class="md-header-nav__button md-logo">
          
            <i class="md-icon">school</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                OI Wiki
              </span>
              <span class="md-header-nav__topic">
                Splay
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/24OI/OI-wiki/" title="前往 Github 仓库" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      24OI/OI-wiki
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." title="简介" class="md-tabs__link">
          简介
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../basic/" title="基础部分" class="md-tabs__link">
          基础部分
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../search/" title="搜索" class="md-tabs__link">
          搜索
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../dp/" title="动态规划" class="md-tabs__link">
          动态规划
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../string/" title="字符串" class="md-tabs__link">
          字符串
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../math/" title="数学" class="md-tabs__link">
          数学
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" title="数据结构" class="md-tabs__link md-tabs__link--active">
          数据结构
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../graph/" title="图论" class="md-tabs__link">
          图论
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../geometry/" title="计算几何" class="md-tabs__link">
          计算几何
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../misc/" title="杂项" class="md-tabs__link">
          杂项
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://oi-wiki.org" title="OI Wiki" class="md-nav__button md-logo">
      
        <i class="md-icon">school</i>
      
    </a>
    OI Wiki
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/24OI/OI-wiki/" title="前往 Github 仓库" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      24OI/OI-wiki
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      简介
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        简介
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/mode/" title="OI 赛制简介" class="md-nav__link">
      OI 赛制简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/resources/" title="学习资源" class="md-nav__link">
      学习资源
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-4" type="checkbox" id="nav-1-4">
    
    <label class="md-nav__link" for="nav-1-4">
      工具软件
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-4">
        工具软件
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/judgers/" title="评测工具" class="md-nav__link">
      评测工具
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/editors/" title="编辑工具" class="md-nav__link">
      编辑工具
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/about/" title="关于本项目" class="md-nav__link">
      关于本项目
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../intro/faq/" title="F.A.Q." class="md-nav__link">
      F.A.Q.
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      基础部分
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        基础部分
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../basic/" title="基础部分简介" class="md-nav__link">
      基础部分简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basic/enumerate/" title="枚举" class="md-nav__link">
      枚举
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basic/simulate/" title="模拟" class="md-nav__link">
      模拟
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basic/divide-and-conquer/" title="分治" class="md-nav__link">
      分治
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basic/greedy/" title="贪心" class="md-nav__link">
      贪心
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basic/sort/" title="排序" class="md-nav__link">
      排序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basic/expression/" title="表达式求值" class="md-nav__link">
      表达式求值
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basic/binary/" title="二分" class="md-nav__link">
      二分
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../basic/construction/" title="构造" class="md-nav__link">
      构造
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      搜索
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        搜索
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../search/" title="搜索部分简介" class="md-nav__link">
      搜索部分简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../search/dfs/" title="DFS" class="md-nav__link">
      DFS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../search/bfs/" title="BFS" class="md-nav__link">
      BFS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../search/dbfs/" title="双向广搜" class="md-nav__link">
      双向广搜
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../search/heuristic/" title="启发式搜索" class="md-nav__link">
      启发式搜索
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../search/astar/" title="Astar" class="md-nav__link">
      Astar
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../search/idastar/" title="IDAstar" class="md-nav__link">
      IDAstar
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../search/iterative/" title="迭代深搜" class="md-nav__link">
      迭代深搜
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../search/backtracking/" title="回溯法" class="md-nav__link">
      回溯法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../search/dlx/" title="Dancing Links" class="md-nav__link">
      Dancing Links
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      动态规划
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        动态规划
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../dp/" title="动态规划部分简介" class="md-nav__link">
      动态规划部分简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dp/memo/" title="记忆化搜索" class="md-nav__link">
      记忆化搜索
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dp/backpack/" title="背包 DP" class="md-nav__link">
      背包 DP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dp/interval/" title="区间 DP" class="md-nav__link">
      区间 DP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dp/dag/" title="DAG 上的 dp" class="md-nav__link">
      DAG 上的 dp
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dp/tree/" title="树形 DP" class="md-nav__link">
      树形 DP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dp/state/" title="状压 DP" class="md-nav__link">
      状压 DP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dp/number/" title="数位 DP" class="md-nav__link">
      数位 DP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dp/plug/" title="插头 DP" class="md-nav__link">
      插头 DP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dp/optimization/" title="优化及其它" class="md-nav__link">
      优化及其它
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dp/misc/" title="其它动规方法" class="md-nav__link">
      其它动规方法
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      字符串
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        字符串
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../string/" title="字符串部分简介" class="md-nav__link">
      字符串部分简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../string/stl/" title="标准库" class="md-nav__link">
      标准库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../string/match/" title="字符串匹配问题" class="md-nav__link">
      字符串匹配问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../string/hash/" title="哈希" class="md-nav__link">
      哈希
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../string/kmp/" title="KMP" class="md-nav__link">
      KMP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../string/trie/" title="字典树（Trie）" class="md-nav__link">
      字典树（Trie）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../string/pam/" title="回文自动机" class="md-nav__link">
      回文自动机
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../string/palindrome-tree/" title="回文树" class="md-nav__link">
      回文树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../string/sa/" title="后缀数组（SA）" class="md-nav__link">
      后缀数组（SA）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../string/ac-automaton/" title="AC 自动机" class="md-nav__link">
      AC 自动机
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../string/sam/" title="后缀自动机（SAM）" class="md-nav__link">
      后缀自动机（SAM）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../string/suffix-tree/" title="后缀树" class="md-nav__link">
      后缀树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../string/manacher/" title="Manacher" class="md-nav__link">
      Manacher
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../string/minimal-string/" title="最小表示法" class="md-nav__link">
      最小表示法
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      数学
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        数学
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/" title="数学部分简介" class="md-nav__link">
      数学部分简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/base/" title="进制相关" class="md-nav__link">
      进制相关
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/prime/" title="素数" class="md-nav__link">
      素数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/gcd/" title="最大公约数" class="md-nav__link">
      最大公约数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/bezouts/" title="贝祖定理" class="md-nav__link">
      贝祖定理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/euler/" title="欧拉函数" class="md-nav__link">
      欧拉函数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/sieve/" title="筛法" class="md-nav__link">
      筛法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/mobius/" title="莫比乌斯反演" class="md-nav__link">
      莫比乌斯反演
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/fermat/" title="费马小定理（欧拉定理）" class="md-nav__link">
      费马小定理（欧拉定理）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/quick-pow/" title="快速幂" class="md-nav__link">
      快速幂
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/crt/" title="中国剩余定理" class="md-nav__link">
      中国剩余定理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/dictionary/" title="分段打表" class="md-nav__link">
      分段打表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/matrix/" title="矩阵" class="md-nav__link">
      矩阵
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/bit/" title="位运算" class="md-nav__link">
      位运算
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/inverse/" title="乘法逆元" class="md-nav__link">
      乘法逆元
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/primitive-root/" title="阶 原根" class="md-nav__link">
      阶 原根
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/bsgs/" title="BSGS" class="md-nav__link">
      BSGS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/game/" title="博弈论" class="md-nav__link">
      博弈论
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/poly/" title="多项式黑科技" class="md-nav__link">
      多项式黑科技
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/combination/" title="排列组合" class="md-nav__link">
      排列组合
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/catalan/" title="卡特兰数" class="md-nav__link">
      卡特兰数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/stirling/" title="斯特林数" class="md-nav__link">
      斯特林数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/cantor/" title="康托展开" class="md-nav__link">
      康托展开
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/expectation/" title="概率与期望" class="md-nav__link">
      概率与期望
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/permutation-group/" title="置换群" class="md-nav__link">
      置换群
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/gauss/" title="高斯消元" class="md-nav__link">
      高斯消元
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/linear-equation/" title="线性方程" class="md-nav__link">
      线性方程
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/inclusion-exclusion-principle/" title="容斥原理" class="md-nav__link">
      容斥原理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/drawer-principle/" title="抽屉原理" class="md-nav__link">
      抽屉原理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/integral/" title="数值积分" class="md-nav__link">
      数值积分
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/fft/" title="快速傅里叶变换" class="md-nav__link">
      快速傅里叶变换
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/ntt/" title="快速数论变换" class="md-nav__link">
      快速数论变换
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/fwt/" title="快速沃尔什变换" class="md-nav__link">
      快速沃尔什变换
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/linear-programming/" title="线性规划" class="md-nav__link">
      线性规划
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/complex/" title="复数" class="md-nav__link">
      复数
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/bignum/" title="高精度" class="md-nav__link">
      高精度
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../math/misc/" title="杂项" class="md-nav__link">
      杂项
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      数据结构
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        数据结构
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="数据结构部分简介" class="md-nav__link">
      数据结构部分简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2">
    
    <label class="md-nav__link" for="nav-7-2">
      STL
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        STL
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../stl/" title="STL 简介" class="md-nav__link">
      STL 简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../stl/vector/" title="vector" class="md-nav__link">
      vector
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../stl/priority_queue/" title="priority_queue" class="md-nav__link">
      priority_queue
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../stl/map/" title="map" class="md-nav__link">
      map
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-3" type="checkbox" id="nav-7-3">
    
    <label class="md-nav__link" for="nav-7-3">
      pb_ds
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-3">
        pb_ds
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../pb-ds/" title="pb_ds 简介" class="md-nav__link">
      pb_ds 简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pb-ds/priority-queue/" title="priority_queue" class="md-nav__link">
      priority_queue
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../stack/" title="栈" class="md-nav__link">
      栈
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../queue/" title="队列" class="md-nav__link">
      队列
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../linked-list/" title="链表" class="md-nav__link">
      链表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hash/" title="哈希表" class="md-nav__link">
      哈希表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dsu/" title="并查集" class="md-nav__link">
      并查集
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../heap/" title="堆" class="md-nav__link">
      堆
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../square-root-decomposition/" title="分块" class="md-nav__link">
      分块
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../monotonous-stack/" title="单调栈" class="md-nav__link">
      单调栈
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../monotonous-queue/" title="单调队列" class="md-nav__link">
      单调队列
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sparse-table/" title="倍增法" class="md-nav__link">
      倍增法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../block-list/" title="块状链表" class="md-nav__link">
      块状链表
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../block-array/" title="块状数组" class="md-nav__link">
      块状数组
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bit/" title="树状数组" class="md-nav__link">
      树状数组
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../segment/" title="线段树" class="md-nav__link">
      线段树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../treap/" title="Treap" class="md-nav__link">
      Treap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sbt/" title="SBT" class="md-nav__link">
      SBT
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="Splay" class="md-nav__link md-nav__link--active">
      Splay
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../scapegoat/" title="替罪羊树" class="md-nav__link">
      替罪羊树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../virtual-tree/" title="虚树" class="md-nav__link">
      虚树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-23" type="checkbox" id="nav-7-23">
    
    <label class="md-nav__link" for="nav-7-23">
      树套树
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-23">
        树套树
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../seg-in-seg/" title="线段树套线段树" class="md-nav__link">
      线段树套线段树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../seg-in-balanced/" title="平衡树套线段树" class="md-nav__link">
      平衡树套线段树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../balanced-in-seg/" title="线段树套平衡树" class="md-nav__link">
      线段树套平衡树
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../avl/" title="AVL 树" class="md-nav__link">
      AVL 树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dividin/" title="划分树" class="md-nav__link">
      划分树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../k-dtree/" title="K-Dtree" class="md-nav__link">
      K-Dtree
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../persistent-seg/" title="可持久化线段树" class="md-nav__link">
      可持久化线段树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../persistent-block-array/" title="可持久化块状数组" class="md-nav__link">
      可持久化块状数组
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../persistent-balanced/" title="可持久化平衡树" class="md-nav__link">
      可持久化平衡树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../persistent-trie/" title="可持久化字典树" class="md-nav__link">
      可持久化字典树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lct/" title="Link Cut Tree" class="md-nav__link">
      Link Cut Tree
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ett/" title="Euler Tour Tree" class="md-nav__link">
      Euler Tour Tree
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tree-decompose/" title="树分块" class="md-nav__link">
      树分块
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      图论
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        图论
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/" title="图论部分简介" class="md-nav__link">
      图论部分简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/basic/" title="图论基础" class="md-nav__link">
      图论基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/tree-basic/" title="树相关基础" class="md-nav__link">
      树相关基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/traverse/" title="遍历：BFS 和 DFS" class="md-nav__link">
      遍历：BFS 和 DFS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/mst/" title="最小生成树" class="md-nav__link">
      最小生成树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/lca/" title="最近公共祖先" class="md-nav__link">
      最近公共祖先
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/heavy-light-decomposition/" title="树链剖分" class="md-nav__link">
      树链剖分
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/tree-divide/" title="树分治" class="md-nav__link">
      树分治
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/tree-misc/" title="树的其他问题" class="md-nav__link">
      树的其他问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/topo/" title="拓扑排序" class="md-nav__link">
      拓扑排序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/dynamic-tree-divide/" title="动态树分治" class="md-nav__link">
      动态树分治
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/2-sat/" title="2-SAT" class="md-nav__link">
      2-SAT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/euler/" title="欧拉图" class="md-nav__link">
      欧拉图
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/scc/" title="强连通分量" class="md-nav__link">
      强连通分量
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/bcc/" title="双连通分量" class="md-nav__link">
      双连通分量
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/bridge/" title="割点割边" class="md-nav__link">
      割点割边
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/differential-constraints/" title="差分约束" class="md-nav__link">
      差分约束
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/dag/" title="有向无环图" class="md-nav__link">
      有向无环图
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/bi-graph/" title="二分图" class="md-nav__link">
      二分图
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/shortest-path/" title="最短路" class="md-nav__link">
      最短路
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/min-circle/" title="最小环" class="md-nav__link">
      最小环
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/kth-path/" title="k 短路" class="md-nav__link">
      k 短路
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/flow/" title="网络流" class="md-nav__link">
      网络流
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/flow/node/" title="拆点" class="md-nav__link">
      拆点
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/flow/max-flow/" title="最大流" class="md-nav__link">
      最大流
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/flow/min-cut/" title="最小割" class="md-nav__link">
      最小割
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/flow/min-cost/" title="费用流" class="md-nav__link">
      费用流
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../graph/flow/bound/" title="上下界网络流" class="md-nav__link">
      上下界网络流
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      计算几何
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        计算几何
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../geometry/" title="计算几何部分简介" class="md-nav__link">
      计算几何部分简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../geometry/2d/" title="二维计算几何基础" class="md-nav__link">
      二维计算几何基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../geometry/3d/" title="三维计算几何基础" class="md-nav__link">
      三维计算几何基础
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../geometry/pick/" title="Pick 定理" class="md-nav__link">
      Pick 定理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../geometry/triangulation/" title="三角剖分" class="md-nav__link">
      三角剖分
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../geometry/convex-hull/" title="凸包" class="md-nav__link">
      凸包
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../geometry/scanning/" title="扫描线" class="md-nav__link">
      扫描线
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../geometry/rotating-calipers/" title="旋转卡壳" class="md-nav__link">
      旋转卡壳
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../geometry/half-plane-intersection/" title="半平面交" class="md-nav__link">
      半平面交
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../geometry/magic/" title="其他黑科技" class="md-nav__link">
      其他黑科技
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      杂项
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        杂项
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/" title="杂项简介" class="md-nav__link">
      杂项简介
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/non-traditional/" title="非传统题（提答大法）" class="md-nav__link">
      非传统题（提答大法）
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/cdq-divide/" title="CDQ 分治" class="md-nav__link">
      CDQ 分治
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/mo-algo/" title="莫队算法" class="md-nav__link">
      莫队算法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/hill-climbing/" title="爬山算法" class="md-nav__link">
      爬山算法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/fractional-programming/" title="分数规划" class="md-nav__link">
      分数规划
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/simulated-annealing/" title="模拟退火" class="md-nav__link">
      模拟退火
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/zhu-liu-algorithm/" title="朱刘算法" class="md-nav__link">
      朱刘算法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/matrix-tree/" title="矩阵树定理" class="md-nav__link">
      矩阵树定理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/random-incremental/" title="随机增量法" class="md-nav__link">
      随机增量法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/random/" title="随机化" class="md-nav__link">
      随机化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/offline/" title="离线处理" class="md-nav__link">
      离线处理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/distance/" title="各种距离" class="md-nav__link">
      各种距离
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/endianness/" title="字节顺序" class="md-nav__link">
      字节顺序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/complexity/" title="复杂度" class="md-nav__link">
      复杂度
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/io/" title="读入和输出优化" class="md-nav__link">
      读入和输出优化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/discrete/" title="离散化" class="md-nav__link">
      离散化
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/dsu-on-tree/" title="树上启发式合并" class="md-nav__link">
      树上启发式合并
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/24OI/OI-wiki/blob/master/docs/ds/splay.md" title="编辑此页" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                 <blockquote class="page-time"></blockquote>
                <blockquote>
<p>如何用 <span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 维护二叉查找树。</p>
</blockquote>
<hr />
<h1 id="_1">简介<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<p><span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 是一种二叉查找树，它通过不断将某个节点旋转到根节点，使得整棵树仍然满足二叉查找树的性质，并且保持平衡而不至于退化为链，它由 Daniel Sleator 和 Robert Tarjan 发明。</p>
<hr />
<h1 id="_2">结构<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h1>
<h3 id="_3">二叉查找树的性质<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>首先肯定是一棵二叉树！</p>
<p>能够在这棵树上查找某个值的性质：左儿子的值 <span><span class="MathJax_Preview">&lt;</span><script type="math/tex"><</script></span> 根节点的值 <span><span class="MathJax_Preview">&lt;</span><script type="math/tex"><</script></span> 右儿子的值。</p>
<h3 id="_4">节点维护信息<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th align="left"><span><span class="MathJax_Preview">rt</span><script type="math/tex">rt</script></span></th>
<th align="left"><span><span class="MathJax_Preview">tot</span><script type="math/tex">tot</script></span></th>
<th align="left"><span><span class="MathJax_Preview">fa[i]</span><script type="math/tex">fa[i]</script></span></th>
<th align="left"><span><span class="MathJax_Preview">ch[i][0/1]</span><script type="math/tex">ch[i][0/1]</script></span></th>
<th align="left"><span><span class="MathJax_Preview">val[i]</span><script type="math/tex">val[i]</script></span></th>
<th align="left"><span><span class="MathJax_Preview">cnt[i]</span><script type="math/tex">cnt[i]</script></span></th>
<th align="left"><span><span class="MathJax_Preview">sz[i]</span><script type="math/tex">sz[i]</script></span></th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">根节点编号</td>
<td align="left">节点个数</td>
<td align="left">父亲</td>
<td align="left">左右儿子编号</td>
<td align="left">节点权值</td>
<td align="left">权值出现次数</td>
<td align="left">子树大小</td>
</tr>
</tbody>
</table>
<hr />
<h1 id="_5">操作<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h1>
<h3 id="_6">基本操作<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<ul>
<li><span><span class="MathJax_Preview">\text{maintain}(x)</span><script type="math/tex">\text{maintain}(x)</script></span>：在改变节点位置前，将节点 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的 <span><span class="MathJax_Preview">\text{size}</span><script type="math/tex">\text{size}</script></span> 更新。</li>
<li><span><span class="MathJax_Preview">\text{get}(x)</span><script type="math/tex">\text{get}(x)</script></span>：判断节点 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 是父亲节点的左儿子还是右儿子。</li>
<li><span><span class="MathJax_Preview">\text{clear}(x)</span><script type="math/tex">\text{clear}(x)</script></span>：销毁节点 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span>。
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">maintain</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">sz</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">+</span><span class="n">cnt</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
<span class="p">}</span>
<span class="kt">bool</span> <span class="nf">get</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">==</span><span class="n">ch</span><span class="p">[</span><span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">]][</span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">clear</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="n">val</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="n">sz</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="n">cnt</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></li>
</ul>
<h3 id="_7">旋转操作<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>为了使 <span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 保持平衡而进行旋转操作，旋转的本质是将某个节点上移一个位置。</p>
<p><strong>旋转需要保证</strong>：</p>
<ul>
<li>整棵 <span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 的中序遍历不变（不能破坏二叉查找树的性质）。</li>
<li>受影响的节点维护的信息依然正确有效。</li>
<li><span><span class="MathJax_Preview">root</span><script type="math/tex">root</script></span> 必须指向旋转后的根节点。</li>
</ul>
<p>在 <span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 中旋转分为两种：左旋和右旋。</p>
<p><img alt="" src="https://s1.ax1x.com/2018/08/24/P7zcRA.png" /></p>
<p><strong>具体分析旋转步骤</strong>（假设需要旋转的节点为 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span>，其父亲为 <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span>，以右旋为例）</p>
<ol>
<li>将 <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> 的左儿子指向 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的右儿子，且 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的右儿子的父亲指向 <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span>。
<code>ch[y][0]=ch[x][1]; fa[ch[x][1]]=y;</code></li>
<li>将 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的右儿子指向 <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span>，且 <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> 的父亲指向 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span>。
<code>ch[x][chk^1]=y; fa[y]=x;</code></li>
<li>如果原来的 <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> 还有父亲 <span><span class="MathJax_Preview">z</span><script type="math/tex">z</script></span>，那么把 <span><span class="MathJax_Preview">z</span><script type="math/tex">z</script></span> 的某个儿子（原来 <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span> 所在的儿子位置）指向 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span>，且 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的父亲指向 <span><span class="MathJax_Preview">z</span><script type="math/tex">z</script></span>。
<code>fa[x]=z; if(z) ch[z][y==ch[z][1]]=x;</code>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">rotate</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">y</span><span class="o">=</span><span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">z</span><span class="o">=</span><span class="n">fa</span><span class="p">[</span><span class="n">y</span><span class="p">],</span><span class="n">chk</span><span class="o">=</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="n">ch</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">chk</span><span class="p">]</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">chk</span><span class="o">^</span><span class="mi">1</span><span class="p">];</span> <span class="n">fa</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">chk</span><span class="o">^</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="n">y</span><span class="p">;</span> <span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">chk</span><span class="o">^</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">y</span><span class="p">;</span>
    <span class="n">fa</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">=</span><span class="n">x</span><span class="p">;</span> <span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="n">z</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="n">ch</span><span class="p">[</span><span class="n">z</span><span class="p">][</span><span class="n">y</span><span class="o">==</span><span class="n">ch</span><span class="p">[</span><span class="n">z</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="n">x</span><span class="p">;</span>
    <span class="n">maintain</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="n">maintain</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></li>
</ol>
<h3 id="splay">Splay 操作<a class="headerlink" href="#splay" title="Permanent link">&para;</a></h3>
<p><span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 规定：每访问一个节点后都要强制将其旋转到根节点。此时旋转操作具体分为 <span><span class="MathJax_Preview">6</span><script type="math/tex">6</script></span> 种情况讨论（其中 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 为需要旋转到根的节点）</p>
<p><img alt="" src="https://s1.ax1x.com/2018/08/24/PHpu7T.png" /></p>
<ul>
<li>如果 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的父亲是根节点，直接将 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 左旋或右旋（图 <span><span class="MathJax_Preview">1,2</span><script type="math/tex">1,2</script></span>）。</li>
<li>如果 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的父亲不是根节点，且 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 和父亲的儿子类型相同，首先将其父亲左旋或右旋，然后将 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 右旋或左旋（图 <span><span class="MathJax_Preview">3,4</span><script type="math/tex">3,4</script></span>）。</li>
<li>如果 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的父亲不是根节点，且 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 和父亲的儿子类型不同，将 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 左旋再右旋、或者右旋再左旋（图 <span><span class="MathJax_Preview">5,6</span><script type="math/tex">5,6</script></span>）。</li>
</ul>
<p>分析起来一大串，其实代码一小段。大家可以自己模拟一下 <span><span class="MathJax_Preview">6</span><script type="math/tex">6</script></span> 种旋转情况，就能理解 <span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 的基本思想了。
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">splay</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">f</span><span class="o">=</span><span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">];</span><span class="n">f</span><span class="o">=</span><span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">f</span><span class="p">;</span><span class="n">rotate</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">if</span><span class="p">(</span><span class="n">fa</span><span class="p">[</span><span class="n">f</span><span class="p">])</span> <span class="n">rotate</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="nl">f</span><span class="p">:</span><span class="n">x</span><span class="p">);</span>
    <span class="n">rt</span><span class="o">=</span><span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></p>
<h3 id="_8">插入操作<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>插入操作是一个比较复杂的过程，具体步骤如下（插入的值为 <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span>）：</p>
<ul>
<li>如果树空了则直接插入根并退出。</li>
<li>如果当前节点的权值等于 <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> 则增加当前节点的大小并更新节点和父亲的信息，将当前节点进行 <span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 操作。</li>
<li>否则按照二叉查找树的性质向下找，找到空节点就插入即可（当然别忘了 <span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 操作哦）。
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">ins</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rt</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">val</span><span class="p">[</span><span class="o">++</span><span class="n">tot</span><span class="p">]</span><span class="o">=</span><span class="n">k</span><span class="p">;</span>
        <span class="n">cnt</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="n">rt</span><span class="o">=</span><span class="n">tot</span><span class="p">;</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">cnr</span><span class="o">=</span><span class="n">rt</span><span class="p">,</span><span class="n">f</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">cnt</span><span class="p">[</span><span class="n">cnr</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
            <span class="n">maintain</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span> <span class="n">maintain</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
            <span class="n">splay</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">f</span><span class="o">=</span><span class="n">cnr</span><span class="p">;</span>
        <span class="n">cnr</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">]</span><span class="o">&lt;</span><span class="n">k</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">cnr</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">val</span><span class="p">[</span><span class="o">++</span><span class="n">tot</span><span class="p">]</span><span class="o">=</span><span class="n">k</span><span class="p">;</span>
            <span class="n">cnt</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
            <span class="n">fa</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="p">;</span>
            <span class="n">ch</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">val</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">&lt;</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">tot</span><span class="p">;</span>
            <span class="n">maintain</span><span class="p">(</span><span class="n">tot</span><span class="p">);</span> <span class="n">maintain</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
            <span class="n">splay</span><span class="p">(</span><span class="n">tot</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></li>
</ul>
<h3 id="x">查询 x 的排名<a class="headerlink" href="#x" title="Permanent link">&para;</a></h3>
<p>根据二叉查找树的定义和性质，显然可以按照以下步骤查询 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的排名：</p>
<ul>
<li>如果 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 比当前节点的权值小，向其左子树查找。</li>
<li>如果 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 比当前节点的权值大，将答案加上左子树（<span><span class="MathJax_Preview">size</span><script type="math/tex">size</script></span>）和当前节点（<span><span class="MathJax_Preview">cnt</span><script type="math/tex">cnt</script></span>）的大小，向其右子树查找。</li>
<li>如果 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 与当前节点的权值相同，将答案加 <span><span class="MathJax_Preview">1</span><script type="math/tex">1</script></span> 并返回。</li>
</ul>
<p>注意最后需要进行 <span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 操作。
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">rk</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">res</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">cnr</span><span class="o">=</span><span class="n">rt</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">&lt;</span><span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">cnr</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">res</span><span class="o">+=</span><span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">]];</span>
            <span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">splay</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span>
                <span class="k">return</span> <span class="n">res</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">res</span><span class="o">+=</span><span class="n">cnt</span><span class="p">[</span><span class="n">cnr</span><span class="p">];</span>
            <span class="n">cnr</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></p>
<h3 id="x_1">查询排名 x 的数<a class="headerlink" href="#x_1" title="Permanent link">&para;</a></h3>
<p>设 <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> 为剩余排名，具体步骤如下：</p>
<ul>
<li>如果左子树非空且剩余排名 <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> 不大于左子树的大小 <span><span class="MathJax_Preview">size</span><script type="math/tex">size</script></span>，那么向左子树查找。</li>
<li>否则将 <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> 减去左子树的和根的大小。如果此时 <span><span class="MathJax_Preview">k</span><script type="math/tex">k</script></span> 的值小于等于 <span><span class="MathJax_Preview">0</span><script type="math/tex">0</script></span>，则返回根节点的权值，否则继续向右子树查找。</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">kth</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">cnr</span><span class="o">=</span><span class="n">rt</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="n">k</span><span class="o">&lt;=</span><span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span> <span class="p">{</span>
            <span class="n">cnr</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">k</span><span class="o">-=</span><span class="n">cnt</span><span class="p">[</span><span class="n">cnr</span><span class="p">]</span><span class="o">+</span><span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">]];</span>
            <span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">];</span>
            <span class="n">cnr</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="_9">查询前驱<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>前驱定义为小于 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的最大的数，那么查询前驱可以转化为：将 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 插入（此时 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 已经在根的位置了），前驱即为 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的左子树中最右边的节点，最后将 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 删除即可。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">pre</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">cnr</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">while</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="n">cnr</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">cnr</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="_10">查询后继<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p>后继定义为大于 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的最小的数，查询方法和前驱类似：<span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的右子树中最左边的节点。</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">nxt</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">cnr</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">while</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="n">cnr</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">cnr</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="_11">删除操作<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p>删除操作也是一个比较复杂的操作，具体步骤如下：</p>
<ul>
<li>首先将 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 旋转到根的位置。</li>
<li>
<p>接下来分为多个情况考虑：</p>
</li>
<li>
<p>如果有不止一个 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span>，那么将 <span><span class="MathJax_Preview">cnt[x]</span><script type="math/tex">cnt[x]</script></span> 减 <span><span class="MathJax_Preview">1</span><script type="math/tex">1</script></span> 并退出。</p>
</li>
<li>如果 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 没有儿子节点，那么直接将当前节点 <span><span class="MathJax_Preview">\text{clear}</span><script type="math/tex">\text{clear}</script></span> 并退出。</li>
<li>如果 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 只有一个儿子，那么先将当前节点 <span><span class="MathJax_Preview">\text{clear}</span><script type="math/tex">\text{clear}</script></span> 再把唯一的儿子作为根节点。</li>
<li>否则将 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的前驱旋转到根并作为根节点，将 <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> 的右子树接到根节点的右子树上，最后要将根的信息更新。</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">del</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">rk</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span><span class="n">cnt</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span><span class="o">--</span><span class="p">;</span><span class="n">maintain</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span><span class="k">return</span><span class="p">;}</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&amp;&amp;!</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span><span class="n">clear</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span><span class="n">rt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="k">return</span><span class="p">;}</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span><span class="kt">int</span> <span class="n">cnr</span><span class="o">=</span><span class="n">rt</span><span class="p">;</span><span class="n">rt</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span><span class="n">fa</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">clear</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span><span class="k">return</span><span class="p">;}</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span><span class="kt">int</span> <span class="n">cnr</span><span class="o">=</span><span class="n">rt</span><span class="p">;</span><span class="n">rt</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span><span class="n">fa</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">clear</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span><span class="k">return</span><span class="p">;}</span>
    <span class="kt">int</span> <span class="n">x</span><span class="o">=</span><span class="n">pre</span><span class="p">(),</span><span class="n">cnr</span><span class="o">=</span><span class="n">rt</span><span class="p">;</span>
    <span class="n">splay</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="n">fa</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="n">x</span><span class="p">;</span>
    <span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">clear</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span>
    <span class="n">maintain</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<hr />
<h1 id="_12">完整代码<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h1>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;cstdio&gt;</span><span class="cp"></span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">N</span><span class="o">=</span><span class="mi">100005</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">rt</span><span class="p">,</span><span class="n">tot</span><span class="p">,</span><span class="n">fa</span><span class="p">[</span><span class="n">N</span><span class="p">],</span><span class="n">ch</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">val</span><span class="p">[</span><span class="n">N</span><span class="p">],</span><span class="n">cnt</span><span class="p">[</span><span class="n">N</span><span class="p">],</span><span class="n">sz</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<span class="k">struct</span> <span class="n">Splay</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="n">maintain</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">sz</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">+</span><span class="n">cnt</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="kt">bool</span> <span class="n">get</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">==</span><span class="n">ch</span><span class="p">[</span><span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">]][</span><span class="mi">1</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">clear</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="n">val</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="n">sz</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="n">cnt</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">rotate</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">y</span><span class="o">=</span><span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">z</span><span class="o">=</span><span class="n">fa</span><span class="p">[</span><span class="n">y</span><span class="p">],</span><span class="n">chk</span><span class="o">=</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="n">ch</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">chk</span><span class="p">]</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">chk</span><span class="o">^</span><span class="mi">1</span><span class="p">];</span> <span class="n">fa</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">chk</span><span class="o">^</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="n">y</span><span class="p">;</span> <span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">chk</span><span class="o">^</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">y</span><span class="p">;</span>
        <span class="n">fa</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">=</span><span class="n">x</span><span class="p">;</span> <span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="n">z</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="n">ch</span><span class="p">[</span><span class="n">z</span><span class="p">][</span><span class="n">y</span><span class="o">==</span><span class="n">ch</span><span class="p">[</span><span class="n">z</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="n">x</span><span class="p">;</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="n">maintain</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">splay</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">f</span><span class="o">=</span><span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">];</span><span class="n">f</span><span class="o">=</span><span class="n">fa</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="n">f</span><span class="p">;</span><span class="n">rotate</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="k">if</span><span class="p">(</span><span class="n">fa</span><span class="p">[</span><span class="n">f</span><span class="p">])</span> <span class="n">rotate</span><span class="p">(</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="n">get</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">?</span><span class="nl">f</span><span class="p">:</span><span class="n">x</span><span class="p">);</span>
        <span class="n">rt</span><span class="o">=</span><span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">ins</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rt</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">val</span><span class="p">[</span><span class="o">++</span><span class="n">tot</span><span class="p">]</span><span class="o">=</span><span class="n">k</span><span class="p">;</span>
            <span class="n">cnt</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
            <span class="n">rt</span><span class="o">=</span><span class="n">tot</span><span class="p">;</span>
            <span class="n">maintain</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="kt">int</span> <span class="n">cnr</span><span class="o">=</span><span class="n">rt</span><span class="p">,</span><span class="n">f</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">cnt</span><span class="p">[</span><span class="n">cnr</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
                <span class="n">maintain</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span> <span class="n">maintain</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
                <span class="n">splay</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">f</span><span class="o">=</span><span class="n">cnr</span><span class="p">;</span>
            <span class="n">cnr</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">]</span><span class="o">&lt;</span><span class="n">k</span><span class="p">];</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">cnr</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">val</span><span class="p">[</span><span class="o">++</span><span class="n">tot</span><span class="p">]</span><span class="o">=</span><span class="n">k</span><span class="p">;</span>
                <span class="n">cnt</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
                <span class="n">fa</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span><span class="o">=</span><span class="n">f</span><span class="p">;</span>
                <span class="n">ch</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">val</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">&lt;</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">tot</span><span class="p">;</span>
                <span class="n">maintain</span><span class="p">(</span><span class="n">tot</span><span class="p">);</span> <span class="n">maintain</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
                <span class="n">splay</span><span class="p">(</span><span class="n">tot</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">rk</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">res</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">cnr</span><span class="o">=</span><span class="n">rt</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">&lt;</span><span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">cnr</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">res</span><span class="o">+=</span><span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">]];</span>
                <span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">])</span> <span class="p">{</span>
                    <span class="n">splay</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span>
                    <span class="k">return</span> <span class="n">res</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">res</span><span class="o">+=</span><span class="n">cnt</span><span class="p">[</span><span class="n">cnr</span><span class="p">];</span>
                <span class="n">cnr</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">kth</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">cnr</span><span class="o">=</span><span class="n">rt</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="n">k</span><span class="o">&lt;=</span><span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span> <span class="p">{</span>
                <span class="n">cnr</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">k</span><span class="o">-=</span><span class="n">cnt</span><span class="p">[</span><span class="n">cnr</span><span class="p">]</span><span class="o">+</span><span class="n">sz</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">]];</span>
                <span class="k">if</span><span class="p">(</span><span class="n">k</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">val</span><span class="p">[</span><span class="n">cnr</span><span class="p">];</span>
                <span class="n">cnr</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">pre</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">cnr</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">while</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="n">cnr</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">return</span> <span class="n">cnr</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">nxt</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">cnr</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
        <span class="k">while</span><span class="p">(</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="n">cnr</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">return</span> <span class="n">cnr</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kt">void</span> <span class="n">del</span><span class="p">(</span><span class="kt">int</span> <span class="n">k</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">rk</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span><span class="n">cnt</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span><span class="o">--</span><span class="p">;</span><span class="n">maintain</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span><span class="k">return</span><span class="p">;}</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">&amp;&amp;!</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span><span class="n">clear</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span><span class="n">rt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="k">return</span><span class="p">;}</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span><span class="kt">int</span> <span class="n">cnr</span><span class="o">=</span><span class="n">rt</span><span class="p">;</span><span class="n">rt</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span><span class="n">fa</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">clear</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span><span class="k">return</span><span class="p">;}</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span><span class="kt">int</span> <span class="n">cnr</span><span class="o">=</span><span class="n">rt</span><span class="p">;</span><span class="n">rt</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">rt</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span><span class="n">fa</span><span class="p">[</span><span class="n">rt</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">clear</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span><span class="k">return</span><span class="p">;}</span>
        <span class="kt">int</span> <span class="n">x</span><span class="o">=</span><span class="n">pre</span><span class="p">(),</span><span class="n">cnr</span><span class="o">=</span><span class="n">rt</span><span class="p">;</span>
        <span class="n">splay</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="n">fa</span><span class="p">[</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="n">x</span><span class="p">;</span>
        <span class="n">ch</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">ch</span><span class="p">[</span><span class="n">cnr</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
        <span class="n">clear</span><span class="p">(</span><span class="n">cnr</span><span class="p">);</span>
        <span class="n">maintain</span><span class="p">(</span><span class="n">rt</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span><span class="n">tree</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="n">opt</span><span class="p">,</span><span class="n">x</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">n</span><span class="p">);</span><span class="n">n</span><span class="p">;</span><span class="o">--</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">opt</span><span class="p">,</span><span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">opt</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="n">tree</span><span class="p">.</span><span class="n">ins</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">opt</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="n">tree</span><span class="p">.</span><span class="n">del</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">opt</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">tree</span><span class="p">.</span><span class="n">rk</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">opt</span><span class="o">==</span><span class="mi">4</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">tree</span><span class="p">.</span><span class="n">kth</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">opt</span><span class="o">==</span><span class="mi">5</span><span class="p">)</span> <span class="n">tree</span><span class="p">.</span><span class="n">ins</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">val</span><span class="p">[</span><span class="n">tree</span><span class="p">.</span><span class="n">pre</span><span class="p">()]),</span><span class="n">tree</span><span class="p">.</span><span class="n">del</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="k">else</span> <span class="n">tree</span><span class="p">.</span><span class="n">ins</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">val</span><span class="p">[</span><span class="n">tree</span><span class="p">.</span><span class="n">nxt</span><span class="p">()]),</span><span class="n">tree</span><span class="p">.</span><span class="n">del</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<hr />
<h1 id="_13">例题<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h1>
<p>以下题目都是裸的 <span><span class="MathJax_Preview">\text{Splay}</span><script type="math/tex">\text{Splay}</script></span> 维护二叉查找树。<del>（直接套板子即可）</del></p>
<ul>
<li><a href="https://www.luogu.org/problemnew/show/P3369">【模板】普通平衡树</a></li>
<li><a href="https://www.lydsy.com/JudgeOnline/problem.php?id=1588">[HNOI2002]营业额统计</a></li>
<li><a href="https://www.lydsy.com/JudgeOnline/problem.php?id=1208">[HNOI2004]宠物收养所</a></li>
</ul>
<h1 id="_14">练习题<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h1>
<p><a href="https://www.lydsy.com/JudgeOnline/problem.php?id=1552">bzoj 1552 [Cerc2007] robotic sort</a> （权限题）</p>
<p><a href="https://www.luogu.org/problemnew/show/P3380">luogu P3380 【模板】二逼平衡树（树套树）</a></p>
<p><a href="https://www.lydsy.com/JudgeOnline/problem.php?id=2827">bzoj 2827 千山鸟飞绝</a></p>
<p><a href="https://www.lydsy.com/JudgeOnline/problem.php?id=4923">bzoj 4923 [Lydsy1706月赛]K小值查询</a></p>
<hr />
<blockquote>
<p>本文部分内容引用于 <a href="https://algocode.net">algocode 算法博客</a>，特别鸣谢！</p>
</blockquote>
                
                  
                
              
              
                <!-- Set from config but allow override -->
 
 

<hr><blockquote class="page-copyright"><p>本页面的全部内容在 <strong>CC BY-SA 4.0 和 SATA</strong> 协议之条款下提供，附加条款亦可能应用</p></blockquote>
<!-- Comments Integration -->


<h2 id="__comments">评论</h2>
<div id="gitment_container">
    <link rel="stylesheet" href="https://24oi.cf/gitment.css">
    <script src="https://24oi.cf/gitment.js"></script>
    <script>
      const myTheme = {
        render(state, instance) {
          const container = document.createElement('div')
          container.lang = "zh-CN"
          container.className = 'gitment-container gitment-root-container'
          const divv = document.createElement('form')
          // container.appendChild(instance.renderSomething(state, instance))
          container.appendChild(instance.renderHeader(state, instance))
          divv.appendChild(instance.renderEditor(state, instance))
          container.appendChild(divv)
          container.appendChild(instance.renderComments(state, instance))
          container.appendChild(instance.renderFooter(state, instance))
          return container
        },
        renderSomething(state, instance) {
          const container = document.createElement('div')
          container.lang = "zh-CN"
          if (state.user.login) {
            container.innerText = `Hello, ${state.user.login}, 来说点什么吧？`
          }
          return container
        }
      }
      const gitment = new Gitment({
        id: 'Splay',
        theme: myTheme,
        owner: 'Ir1d',
        repo: 'gitment',
        oauth: {
          client_id: 'd6a911c8fba0194626d4',
          client_secret: '867ec7e13cc99b420bd147cbb62d5cfec271ba81',
        },
      })
      gitment.render('gitment_container')
    </script>
</div>

              
            </article>
          </div>
        </div>
      </main>
      
        <!--
  Copyright (c) 2016-2018 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->



<!-- back to top -->
<link rel="stylesheet" href="https://npmcdn.com/data-tip@0.0.52/dist/data-tip.css">
<script>
// 当网页向下滑动 20px 出现"返回顶部" 按钮
window.onscroll = function() {scrollFunction()};
 
function scrollFunction() {console.log(121);
    if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
        document.getElementById("myBtn").style.display = "block";
    } else {
        document.getElementById("myBtn").style.display = "none";
    }
}
 
// 点击按钮，返回顶部
function topFunction() {
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
}
</script>
<button onclick="topFunction()" id="myBtn" class="data-tip-left" data-tip="回到顶部">
  <svg class="Zi Zi--BackToTop data-tip-left" data-tip="回到顶部" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M16.036 19.59a1 1 0 0 1-.997.995H9.032a.996.996 0 0 1-.997-.996v-7.005H5.03c-1.1 0-1.36-.633-.578-1.416L11.33 4.29a1.003 1.003 0 0 1 1.412 0l6.878 6.88c.782.78.523 1.415-.58 1.415h-3.004v7.005z"></path></svg>
</button>


<!-- Application footer -->
<footer class="md-footer">

  <!-- Link to previous and/or next page -->
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">

        <!-- Link to previous page -->
        
          <a href="../sbt/"
              title="SBT"
              class="md-flex md-footer-nav__link md-footer-nav__link--prev"
              rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back
                    md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch
                  md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  后退
                </span>
                SBT
              </span>
            </div>
          </a>
        

        <!-- Link to next page -->
        
          <a href="../scapegoat/"
              title="替罪羊树"
              class="md-flex md-footer-nav__link md-footer-nav__link--next"
              rel="next">
            <div class="md-flex__cell md-flex__cell--stretch
                  md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前进
                </span>
                替罪羊树
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward
                    md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">

      <!-- Copyright and theme information -->
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2016 - 2018 OI Wiki Team
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>

      <!-- Social links -->
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.e72fd936.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../assets/javascripts/lunr/lunr.jp.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.3",url:{base:"../.."}})</script>
      
        <script src="https://oi-wiki.org/analytics.js"></script>
      
        <script src="../../_static/js/extra.js?v=2"></script>
      
        <script src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
    
    
      
    
  </body>
</html>